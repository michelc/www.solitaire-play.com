"use strict";function Start(bp){K.start(bp);cg(K.an);$("#stock").on("click",ct);$(options.src).on(options.evt,".card:last-child",cs);$("#game, #again").on("click",cq);$("#hint").on("click",cf);$("#undo").on("click",cj);$("#tool, #list").on("click",cd);$("body").on("contextmenu",ce);$(document).on("keyup",function(n){n.which===113?cq():n.which===72?cf():n.which===90?n.ctrlKey&&cj():(n.which===13||n.which===32)&&$("#win").is(":visible")&&cq()}).on("keydown",function(n){n.which===32&&n.preventDefault()});ci()}function ce(n){var bi,t,i,bt;for(ck(),K.bd(),bi=null,t=null,i=0;i<K.bu.length;i++)if(bi=K.bu[i],bi.aa!=="draw"){if(!bi.ae.ax())if(K.id==="MonteCarlo"){if(0)continue}else if(K.id==="Pyramid"){if(0)continue}else continue;t=bi;break}return t===null?!1:(bt=K.bv(t.aa,t.az,t.ae.id),cp(bt),ce(n),!1)}function cr(){try{try{$(".ui-draggable").draggable("destroy")}catch(n){}try{$(".drop").droppable("destroy")}catch(n){}}catch(t){}$("body").css("cursor","auto")}function ct(){K.bg();cg(K.an);ci()}function cy(n,t){var aa=t.draggable[0].id,az=$("#"+aa).parent().attr("id"),bt=K.bv(aa,az,this.id);cp(bt)}function cu(){if(options.dad!==""){var n={containment:"#solitaire",cursor:"move",revert:!0,opacity:1.7,revertDuration:"fast",helper:function(){var n=$(this),af=n.nextAll().addBack(),t=$("<div/>").append(af.clone()).css("margin-top",n.css("margin-top")).css("margin-left",n.css("margin-left"));return af.addClass("hide"),t},start:function(n,t){t.helper.css("z-index",1);var i={hoverClass:"hovered",tolerance:options.mod,drop:cy};$(".drop").droppable(i)},stop:function(n,t){t.helper.css("z-index",0);$(".card").removeClass("hide")}};$(options.dad).draggable(n)}}function ci(){$(".dialog").hide();cu();ch();var bn=K.bn();bn!==0&&($("#win h3").hide(),bn>0&&$("#win .win").show(),bn<0&&$("#win .lost").show(),$("#win").show(),$("#overlay").show(),setTimeout(function(){$("#overlay").hide()},1e3))}function co(bv){var n=K.bk(bv.az);cg([n]);cg([bv.ae])}function cp(bt){if(bt.length!==0){cr();for(var n=0;n<bt.length;n++)co(bt[n]);ci()}}function cq(){K.count<10?(K.start(),cg(K.an),ci()):location.reload()}function cs(n,aa){aa||(aa=this.id);var az=$("#"+aa).parent().attr("id"),bt=K.bv(aa,az,options.dst);cp(bt)}function cd(){$(".dialog").hide();var bb=$("#run");bb.show()}function cf(){var bi;for(ck();L.length>0;)clearTimeout(L.pop());if($(".hint").removeClass("hint"),$("#zombie").remove(),bi=K.bh(),bi!==null){var i=500,t=1500,aa=bi.aa,n=bi.ae;n.id==="stock"?(i-=500,t-=500):$("#"+aa).addClass("hint");n.id==="waste"?t-=500:n.aw()?$("#"+n.id).append("<div id='zombie' class='card hint space'>"):(aa=n.ak().ap,L.push(setTimeout(function(){$("#"+aa).addClass("hint")},i)));L.push(setTimeout(function(){$(".hint").removeClass("hint");$("#zombie").remove()},t))}}function cg(an){for(var n=0;n<an.length;n++)an[n]!==null&&($("#"+an[n].id+" .card").remove(),$("#"+an[n].id).append(an[n].ad()))}function ch(){var t=K.bf()?"+":"Ã—",n;$(".draw div").text(t);n=K.ba.af.length;K.id==="AcesUp"&&(n/=4);n<6&&n>0&&$(".count .card:last-child").html("<div>"+n.toString()+"<\/div>")}function cj(){cp(K.cz())}function ck(){K.bs!==null&&(K.bs.ae.ak().ao=!1,cg([K.bs.ae]),K.bs=null)}var E=["Ace","2","3","4","5","6","7","8","9","10","Jack","Queen","King"],F=["Hearts","Spades","Diamonds","Clubs"],G=0,H=1,I=2,J=3,A=function(){function A(aa,az,ae){this.aa=aa;this.az=az;this.ae=ae}return A}(),B=function(){function B(n){this.id=n;this.ar=n%13;this.at=Math.floor(n/13);this.ay=this.at===G||this.at===I;this.au=!this.ay;this.ai=!1;this.ao=!1;this.ap=F[this.at][0]+(this.ar===9?"T":E[this.ar][0]);this.html="<div id='"+this.ap+"' class='card down'><\/div>"}return B.prototype.aq=function(){return this.ar===0},B.prototype.as=function(){return this.ar===12},B.prototype.ad=function(){var n=this.html;return this.ao&&(n=n.replace(" down"," down selected")),this.ai&&(n=n.replace(" down"," up")),n},B.prototype.toString=function(){return E[this.ar]+" "+F[this.at]},B}(),C=function(){function C(){this.af=[];for(var n=0;n<52;n++)this.af[n]=new B(n);for(n=0;n<this.af.length;n++)this.af[n]=this.af.splice(Math.floor(this.af.length*Math.random()),1,this.af[n])[0]}return C.prototype.ag=function(n){return n>this.af.length&&(n=this.af.length),this.af.splice(0,n)},C}(),D=function(){function D(ah,af,n){this.ah=ah;this.af=af;this.id=n;this.aj=-1}return D.prototype.ak=function(){return this.af[this.af.length-1]},D.prototype.al=function(aa){for(var n=0;n<this.af.length;n++)if(this.af[n].ap===aa)return n;return-1},D.prototype.am=function(){for(var n=0;n<this.af.length;n++)if(this.af[n].ai)return n;return-1},D.prototype.aw=function(){return this.af.length===0},D.prototype.ax=function(){return this.id[0]==="f"},D.prototype.ac=function(){return this.id[0]==="s"},D.prototype.av=function(){return this.id[0]==="t"},D.prototype.ab=function(){return this.id[0]==="w"},D.prototype.ad=function(){var r="",i=this.aj,n,t;for(i<0&&(i=this.af.length),n=this.af.length-i,n<0&&(n=0),t=n;t<this.af.length;t++)r+=this.af[t].ad();return r},D.prototype.toString=function(){return this.id},D}(),Q=function(){function Q(){this.an=[];this.ba=null;this.bz=null;this.be=[];this.br=[];this.bt=[];this.by=!1;this.bu=null;this.bi=-1;this.bo=!0;this.id="MonteCarlo";this.bp=0;this.count=0;this.bq=!0;this.bs=null}return Q.prototype.bd=function(){var n,t,r,aa,i,e,f,af,o,u;for(this.bu=[],this.bi=-1,i=this.bj(),e=i.length,n=0;n<e;n++)for(aa=i[n].ak().ap,t=0;t<this.br.length;t++)if(this.bx(aa,i[n].id,this.br[t].id)){this.bu.push(new A(aa,i[n].id,this.br[t]));break}for(f=[],n=0;n<e;n++)for(af=this.getCards(i[n]),r=0;r<af.length;r++)for(aa=af[r].ap,t=0;t<this.be.length;t++)if(this.bx(aa,i[n].id,this.be[t].id)){for(o=!1,u=0;u<this.bu.length;u++)if(this.bu[u].az===this.be[t].id&&this.bu[u].ae.id===i[n].id){o=!0;break}o||(r===0?this.bu.push(new A(aa,i[n].id,this.be[t])):f.push(new A(aa,i[n].id,this.be[t])))}f.length>0&&(this.bu=this.bu.concat(f));this.bu.length===0&&this.bf()&&this.bu.push(new A("draw",this.ba.id,this.ba));this.bo=this.bu.length!==0},Q.prototype.bf=function(){return this.id==="Cruel"||this.id==="MonteCarlo"?!this.bq:this.ba&&this.ba.af.length>0?!0:(this.id==="Klondike"||this.id==="Pyramid")&&this.bz.af.length>0?!0:!1},Q.prototype.ag=function(){var n=function(ah){var n=null;switch(ah){case 27:break;case 25:n="f0";break;case 26:n="stock";break;default:n="t"+ah.toString()}return n};this.bb(n);this.bg()},Q.prototype.bg=function(){for(var t,n=0;n<this.be.length;n++)t=this.be[24-n].af.pop(),t&&this.ba.af.unshift(t);for(n=0;n<this.be.length;n++){if(this.ba.af.length===0)break;t=this.ba.af.shift();t.ai=!0;t.ao=!1;this.an[n].af=[t]}this.bs=null;this.bt=[];this.bq=!0;this.bd()},Q.prototype.getCards=function(ae){var t=ae.af.length,i=t-1,r=[],n;for(this.id==="Yukon"&&(i=ae.am()),n=i;n<t;n++)r.push(ae.af[n]);return r},Q.prototype.bh=function(){return(this.bu===null&&this.bd(),!this.bo)?null:(this.bi++,this.bi===this.bu.length&&(this.bi=0),this.bu[this.bi])},Q.prototype.bj=function(){var n=this.be.filter(function(n){return!n.aw()}),t=this.id==="Cruel";return n.sort(function(n,i){var r=i.af.length-n.af.length;return t&&(r=i.ak().ar-n.ak().ar),r===0&&(r=n.ah-i.ah),r}),this.id==="Pyramid"&&this.bz.af.length>0&&n.push(this.bz),n},Q.prototype.bk=function(n){for(var t=0;t<this.an.length;t++)if(this.an[t].id===n)return this.an[t];return null},Q.prototype.bx=function(aa,az,n){var f,o,i,u;if(this.by)return!0;if(az===n||(f=this.bk(az),f.ax())||(o=f.ak(),aa!==o.ap))return!1;if(i=this.bk(n),f.ac())return i.av();if(i.ax()||i.ac()||i.aw()||o.ar!==i.ak().ar)return!1;var t=f.ah,e=Math.floor(t/5),r=[];return(r.push(t),t>0&&e===Math.floor((t-1)/5)&&r.push(t-1),t<25&&e===Math.floor((t+1)/5)&&r.push(t+1),u=r,e>0&&(u=u.concat(r.map(function(n){return n-5}))),e<4&&(u=u.concat(r.map(function(n){return n+5}))),u.indexOf(i.ah)===-1)?!1:!0},Q.prototype.bv=function(aa,az,n){var bt=[],i=this.bk(az),t,r;if(n!=="?"){if(!this.bx(aa,az,n))return[]}else this.bs===null?(i.ak().ao=!0,this.bs=new A(aa,az,i),bt.push(new A(aa,az,null))):this.bx(aa,az,this.bs.az)?(n=this.bs.az,this.bs=null):(this.bs.ae.ak().ao=!1,bt.push(this.bs),this.bs=null);return n==="?"?bt:(r=this.bk(n),i.av()&&r.av()?(bt.push(this.ca("list","",null)),t=r.af.pop(),t.ao=!1,this.br[0].af.push(t),bt.push(this.ca(t.ap,r.id,this.br[0])),t=i.af.pop(),this.br[0].af.push(t),bt.push(this.ca(t.ap,i.id,this.br[0])),bt.push(this.ca("list","",null))):(t=i.af.pop(),r.af.push(t),bt.push(this.ca(aa,az,r))),this.bq=!1,bt)},Q.prototype.bb=function(n){for(var r=new C,i,t=0;t<99;t++){if(i=n(t),i===null)break;this.an[t]=new D(t,[],i)}for(this.be=[],this.br=[],t=0;t<this.an.length;t++)switch(this.an[t].id[0]){case"s":this.ba=this.an[t];break;case"w":this.bz=this.an[t];break;case"t":this.be.push(this.an[t]);break;case"f":this.br.push(this.an[t])}this.ba||(this.ba=new D(99,[],""));this.ba.af=r.ag(99);this.bt=[];this.bu=null},Q.prototype.start=function(bp){for(var bn=-1;bn===-1;)this.ag(bp),bn=this.bn();this.count++},Q.prototype.bn=function(){return this.br[0].af.length===52?1:(this.bd(),!this.bo)?-1:0},Q.prototype.ca=function(aa,az,ae){this.bu=null;var bv=new A(aa,az,ae);return this.by||this.bt.push(bv),bv},Q.prototype.cz=function(){var n,t,i,r,u,bt;if(this.bt.length===0)return[];n=this.bt[this.bt.length-1];t=0;n.aa==="list"?(t=99999,n=this.bt.pop()):t=n.ae===null?2:1;i=[];this.by=!0;do n=this.bt.pop(),n.aa==="list"?t=0:n.ae===null?(r=this.bk(n.az),u=r.al(n.aa),r.af[u].ai=!r.af[u].ai,i.push(n)):(bt=this.bv(n.aa,n.ae.id,n.az),i.push(bt[0])),t--;while(t>0);return this.by=!1,i},Q}(),K=new Q,L=[],options={evt:"click",src:".drop",dst:"?",dad:"",mod:"intersect"}