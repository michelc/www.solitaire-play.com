"use strict";function Start(bf){M.start(bf);dr(M.be);$("#stock").on("click",cm);$(L.src).on(L.evt,".card:last-child",cn);$("#game, #again").on("click",cb);$("#hint").on("click",dz);$("#undo").on("click",dy);$("#tool, #list").on("click",da);$(".close").on("click",function(){$(".dialog").hide()});$("body").on("contextmenu",ck);$(document).on("keyup",function(n){n.which===113?cb():n.which===72?dz():n.which===90?n.ctrlKey&&dy():(n.which===13||n.which===32)&&M.cf()&&cb()}).on("keydown",function(n){n.which===32&&n.preventDefault()});cx()}function ck(n,t){var i,bo;if(n.preventDefault(),!M.bk||t)return(du(),i=M.cz(),M.bk=i!==null,!M.bk)?(cl(!0),!1):(bo=M.cs(i.aa,i.az,i.ae.id),de(bo,function(){ck(n,!0)}),!1)}function cl(n){if(L.dad!==""){if(!n){try{try{$(".ui-draggable").draggable("destroy")}catch(i){}try{$(".drop").droppable("destroy")}catch(i){}}catch(r){}$("body").css("cursor","auto");return}var t={containment:"#solitaire",cursor:"move",revert:!0,opacity:1.7,revertDuration:"fast",helper:function(n){var t=$(n.target),af=t.nextAll().addBack(),i=$("<div/>").append(af.clone()).css("margin-top",t.css("margin-top")).css("margin-left",t.css("margin-left"));return af.addClass("hide"),i},start:function(n,t){t.helper.css("z-index",1);var i={hoverClass:"hovered",tolerance:L.mod,drop:function(n,t){cw(n,t.draggable[0].id)}};$(".drop").droppable(i)},stop:function(n,t){t.helper.css("z-index",0);$(".card").removeClass("hide")}};$(L.dad).draggable(t)}}function cm(){M.bk||M.bb()&&(M.ca(),de(null),cx())}function cw(n,aa){var az,bo,t;M.bk||(az=$("#"+aa).parent().attr("id"),bo=M.cs(aa,az,n.target.id),cv(bo),M.bj&&(t=M.cy(az),t.av()||setTimeout(function(){ck(n)},5)))}function cx(){$(".dialog").hide();M.bk||cl(!0);dt();var cf=M.cf();cf!==0&&($("#win h3").hide(),cf>0&&$("#win .win").show(),cf<0&&$("#win .lost").show(),$("#win").show(),$("#overlay").show(),setTimeout(function(){$("#overlay").hide()},1e3))}function cc(cs){var n=M.cy(cs.az);dr([n]);dr([cs.ae])}function cv(bo){if(bo.length!==0){cl(!1);for(var n=0;n<bo.length;n++)cc(bo[n]);cx()}}function cb(){var n,t,i;if(!M.bk){while(K.length>0)clearTimeout(K.pop());n=M.bg[1];t=M.bg[0];M.count<(n?1:10)?(M.start(),dr(M.be),cx()):i=n?location=t(n):location.reload()}}function cn(n){if(!M.bk){var aa=n.target.id,az=$("#"+aa).parent().attr("id"),bo=M.cs(aa,az,L.dst);de(bo,M.bj?function(){ck(n)}:null)}}function da(){M.bk||(window.scrollTo(0,0),$(".dialog").hide(),$("#run").show())}function dz(){var bs;if(!M.bk){for(du();K.length>0;)clearTimeout(K.pop());if($(".hint").removeClass("hint"),$("#zombie").remove(),bs=M.cr(),bs!==null){var i=500,t=1500,aa=bs.aa,n=bs.ae;n.id==="stock"?(i-=500,t-=500):$("#"+aa).addClass("hint");n.id==="waste"?t-=500:n.ac()?$("#"+n.id).append("<div id='zombie' class='card hint space'>"):(aa=n.am().ap,K.push(setTimeout(function(){$("#"+aa).addClass("hint")},i)));K.push(setTimeout(function(){$(".hint").removeClass("hint");$("#zombie").remove()},t))}}}function dr(be){for(var i,t,ar,n=0;n<be.length;n++)be[n]!==null&&($("#"+be[n].id+" .card").remove(),$("#"+be[n].id).append(be[n].ad()));for($(".drag").removeClass("drag"),i=M.bn(),t=0;t<i.length;t++)$("#"+i[t]).addClass("drag");M.bw!==null&&(ar=M.bw===9?"10":I[M.bw][0],$(".drop .write div").text(ar))}function dt(){var t=M.bb()?"+":"×",n;$("#stock .write div").text(t);n=M.bt.af.length;M.id==="AcesUp"&&(n/=4);n<6&&n>0&&$(".count .card:last-child").html("<div>"+n.toString()+"<\/div>")}function dy(){M.bk||M.bp||de(M.cj(),function(){M.bp=!1})}function du(){M.bm!==null&&(M.bm.ae.am().ao=!1,dr([M.bm.ae]),M.bm=null)}function de(bo,n){var r,u,t;if(!M.bh){bo===null?dr(M.be):cv(bo);n&&n();return}if(bo===null&&(bo=M.bo.slice(-2),bo[1].aa==="list")){dr(M.be);return}if(bo.length>0&&bo[0].ae===null&&bo.shift(),bo.length!==0){bo.length>1&&M.id==="AcesUp"&&(cv(bo),n&&n());var e=$("#"+bo[0].aa),f=e.offset(),i=bo[0].ae;$("#"+i.id).append("<div id='target' class='card hint space'>");r=$("#target");u=r.offset();r.remove();var o=u.left-f.left,s=u.top-f.top,aj=i.aw(bo[0].aa),af=i.af;for(t=aj;t<af.length;t++)$("#"+af[t].ap).css("z-index",100+t).css("transition","all 200ms ease-in-out").css("transform","translate("+o+"px, "+s+"px)");setTimeout(function(){cv(bo);n&&n()},205)}}var J=["Clubs","Diamonds","Hearts","Spades"],I=["Ace","2","3","4","5","6","7","8","9","10","Jack","Queen","King"],H=0,G=1,E=2,F=3,D=function(){function D(aa,az,ae){this.aa=aa;this.az=az;this.ae=ae}return D}(),A=function(){function A(n){this.id=n;this.ar=Math.floor(n/4);this.at=n%4;this.ay=this.at===E||this.at===G;this.au=!this.ay;this.ai=!1;this.ao=!1;this.ap=J[this.at][0]+(this.ar===9?"T":I[this.ar][0]);this.html="<div id='"+this.ap+"' class='card down'><\/div>"}return A.prototype.aq=function(){return this.ar===0},A.prototype.as=function(){return this.ar===12},A.prototype.ad=function(){var n=this.html;return this.ao&&(n=n.replace(" down"," down selected")),this.ai&&(n=n.replace(" down"," up")),n},A.prototype.toString=function(){return I[this.ar]+" "+J[this.at]},A}(),B=function(){function B(){this.af=[];for(var n=0;n<52;n++)this.af[n]=new A(n);for(n=0;n<this.af.length;n++)this.af[n]=this.af.splice(Math.floor(this.af.length*Math.random()),1,this.af[n])[0]}return B.prototype.ag=function(n){return n>this.af.length&&(n=this.af.length),this.af.splice(0,n)},B}(),C=function(){function C(aj,n){this.aj=aj;this.af=[];this.id=n;this.ak=-1}return C.prototype.am=function(){return this.af[this.af.length-1]},C.prototype.aw=function(aa){for(var n=0;n<this.af.length;n++)if(this.af[n].ap===aa)return n;return-1},C.prototype.ax=function(){for(var n=0;n<this.af.length;n++)if(this.af[n].ai)return n;return-1},C.prototype.ac=function(){return this.af.length===0},C.prototype.av=function(){return this.id[0]==="f"},C.prototype.ab=function(){return this.id[0]==="r"},C.prototype.an=function(){return this.id[0]==="s"},C.prototype.ba=function(){return this.id[0]==="t"},C.prototype.bz=function(){return this.id[0]==="w"},C.prototype.ad=function(){var r="",i=this.ak,n,t;for(i<0&&(i=this.af.length),n=this.af.length-i,n<0&&(n=0),t=n;t<this.af.length;t++)r+=this.af[t].ad();return r},C.prototype.toString=function(){return this.id},C}(),δ=function(){function δ(){this.be=[];this.br=[];this.bt=null;this.by=null;this.bu=[];this.bi=[];this.bo=[];this.bp=!1;this.bq=null;this.bs=-1;this.bd=!0;this.id="Australian";this.bf=1;this.bg=["",""];this.bh=!0;this.bj=!1;this.bk=!1;this.count=0;this.bl=!0;this.bm=null;this.bw=null;this.bx=0;this.bc=0;try{this.bg=[atob,null]}catch(n){}}return δ.prototype.bv=function(){var n,t,r,f,aa,i,s,e,af,h,u,c,o;for(this.bq=[],this.bs=-1,i=this.ct(),s=i.length,n=0;n<s;n++)for(aa=i[n].am().ap,t=0;t<this.bi.length;t++)if(this.cp(aa,i[n].id,this.bi[t].id)){this.bq.push(new D(aa,i[n].id,this.bi[t]));break}for(e=[],n=0;n<s;n++)for(af=this.ce(i[n]),r=0;r<af.length;r++)for(h=af[r].as()&&i[n].af[0]==af[r]&&i[n].ba(),aa=af[r].ap,t=0;t<this.bu.length;t++)if(this.cp(aa,i[n].id,this.bu[t].id)){if(u=!0,h&&this.bu[t].ba()&&(u=!1),u&&this.id==="AcesUp"&&i[n].af.length===1&&this.bu[t].ac()&&(u=!1),u)for(f=0;f<this.bq.length;f++)if(this.bq[f].az===this.bu[t].id&&this.bq[f].ae.id===i[n].id){u=!1;break}u&&(r===0?this.bq.push(new D(aa,i[n].id,this.bu[t])):e.push(new D(aa,i[n].id,this.bu[t])))}e.length>0&&(this.bq=this.bq.concat(e));this.bq.length===0&&this.bb()&&this.bq.push(new D("draw",this.bt.id,this.bt));this.bg[1]===null&&(c="aHR0cHM6Ly93d3cuc2",o=""+location,this.bg[1]=o.indexOf("alh")>0||o.indexOf("e-p")>0||o.indexOf("f")===0?"":c+"9saXRhaXJlLXBsYXkuY29t");this.bd=this.bq.length!==0;this.id==="FreeCell"&&this.br.reduce(function(n,t){return n+t.af.length},0)<4&&(this.bd=!0)},δ.prototype.bb=function(){return this.id==="Cruel"||this.id==="MonteCarlo"?!this.bl:this.bt&&this.bt.af.length>0?!0:this.bx>=this.bc?!1:this.by&&this.by.af.length>0?!0:!1},δ.prototype.ag=function(){var t,n;for(this.bx=0,this.bf===-1&&(this.bc=1),t=function(aj){var n=null;switch(aj){case 13:break;case 12:n="stock";break;case 11:n="waste";break;case 0:case 1:case 2:case 3:n="f"+(+aj).toString();break;default:n="t"+(aj-4).toString()}return n},this.cd(t),n=0;n<28;n++)this.bt.af[n].ai=!0;for(n=0;n<this.bu.length;n++)this.bu[n].af=this.bt.af.splice(0,4)},δ.prototype.bn=function(){for(var ae,i,t=[],n=0;n<this.be.length;n++)(ae=this.be[n],ae.ac())||ae.an()||(i=ae.id+" .up",t.push(i));return t},δ.prototype.ca=function(){if(this.bt.id!==""){if(this.bt.ac()){if(!(this.bx>=this.bc)&&this.by&&!this.by.ac()){for(this.bx++,this.cg("list",null,null);!this.by.ac();)this.ch(this.by,this.bt);this.cg("list",null,null)}}else{this.bf===3&&this.cg("list",null,null);for(var n=0;n<Math.abs(this.bf);n++)this.ch(this.bt,this.by||this.bi[0]);this.bf===3&&this.cg("list",null,null)}this.bl=!0;this.bv()}},δ.prototype.cz=function(){var n,bs;for(this.bv(),n=0;n<this.bq.length;n++)if(bs=this.bq[n],bs.aa!=="draw"){if(!bs.ae.av())if(this.id==="MonteCarlo"){if(bs.az[0]!=="t")continue}else if(this.id==="Pyramid"){if(bs.az[0]!=="t"&&bs.az[0]!=="w")continue}else continue;return bs}return null},δ.prototype.ce=function(ae){var i=ae.af.length,t=i-1,r=[],n;for(this.id==="Yukon"&&(t=ae.ax()),this.id==="Australian"&&(t=0),n=t;n<i;n++)r.push(ae.af[n]);return r},δ.prototype.cr=function(){return(this.bq===null&&this.bv(),!this.bd)?null:(this.bs++,this.bs===this.bq.length&&(this.bs=0),this.bq[this.bs])},δ.prototype.ct=function(){var n=this.bu.filter(function(n){return!n.ac()}),i=this.id==="Cruel",t;if(n.sort(function(n,t){var r=t.af.length-n.af.length;return i&&(r=t.am().ar-n.am().ar),r===0&&(r=n.aj-t.aj),r}),this.id==="Pyramid"&&this.by.af.length>0&&n.push(this.by),this.id==="Canfield"&&this.by.af.length>0&&n.push(this.by),this.id==="Canfield"&&this.br[0].af.length>0&&n.push(this.br[0]),this.id==="FreeCell")for(t=0;t<this.br.length;t++)this.br[t].ac()||n.push(this.br[t]);return this.id==="Australian"&&this.by.af.length>0&&n.push(this.by),n},δ.prototype.cy=function(n){for(var t=0;t<this.be.length;t++)if(this.be[t].id===n)return this.be[t];return null},δ.prototype.cp=function(aa,az,n){var i,u;if(this.bp)return!0;if(az===n)return!1;var r=this.cy(az),f=r.aw(aa),t=r.af[f];return t.ai?(i=this.cy(n),u=i.am(),i.ba())?!r.ba()&&aa!==r.am().ap?!1:i.ac()?t.as():t.at!==u.at?!1:t.ar!==u.ar-1?!1:!0:i.av()?aa!==r.am().ap?!1:i.ac()?t.aq():t.at!==u.at?!1:t.ar===u.ar+1:!1:!1},δ.prototype.cs=function(aa,az,n){var u=["f0","f1","f2","f3"],t,r,i,bo;for(n!=="?"&&(u=[n]),t=0;t<u.length;t++){if(n=u[t],this.cp(aa,az,n))break;n=""}if(n==="")return[];var f=this.cy(az),e=this.cy(n),o=f.aw(aa),af=f.af.splice(o);for(t=0;t<af.length;t++)e.af.push(af[t]);return this.bl=!1,r=null,this.bp||(i=f.am(),i&&!i.ai&&(i.ai=!0,r=i.ap)),bo=[this.cg(aa,az,e)],r&&bo.push(this.cg(r,az,null)),bo},δ.prototype.cd=function(n){for(var r=new B,i,t=0;t<99;t++){if(i=n(t),i===null)break;this.be[t]=new C(t,i)}for(this.bu=[],this.bi=[],this.br=[],t=0;t<this.be.length;t++)switch(this.be[t].id[0]){case"r":this.br.push(this.be[t]);break;case"s":this.bt=this.be[t];break;case"w":this.by=this.be[t];this.by.ak=3;break;case"t":this.bu.push(this.be[t]);break;case"f":this.bi.push(this.be[t])}this.bt||(this.bt=new C(99,""));this.bt.af=r.ag(99);this.bo=[];this.bq=null},δ.prototype.start=function(bf){bf&&(this.bf=bf);for(var cf=-1;cf===-1;)this.ag(),this.ca(),cf=this.cf();this.count++},δ.prototype.cf=function(){if(this.bp)return 0;var n=this.bi.reduce(function(n,t){return n+t.af.length},0);return n===52?1:n===48&&this.id==="AcesUp"?1:(n=this.bu.reduce(function(n,t){return n+t.af.length},0),n===0&&this.id==="Golf")?1:n===0&&this.id==="Pyramid"?1:(this.bv(),!this.bd)?-1:0},δ.prototype.cg=function(aa,az,ae){this.bq=null;var cs=new D(aa,az,ae);return this.bp||this.bo.push(cs),cs},δ.prototype.ch=function(n,t){if(!n.ac()){var i=n.af.pop();t.af.push(i);this.cg(i.ap,n.id,t);i.ai=n.an();this.cg(i.ap,t.id,null)}},δ.prototype.cj=function(){var n,t,i,u,r,f,bo;if(this.bo.length===0)return[];n=this.bo[this.bo.length-1];t=0;n.aa==="list"?(t=99999,n=this.bo.pop()):t=n.ae===null?2:1;i=[];u=!1;this.bp=!0;do n=this.bo.pop(),n.aa==="list"?t=0:n.ae===null?(r=this.cy(n.az),f=r.aw(n.aa),r.af[f].ai=!r.af[f].ai,i.push(n)):(bo=this.cs(n.aa,n.ae.id,n.az),i.push(bo[0]),n.az==="waste"&&n.ae.id==="stock"&&(u=!0)),t--;while(t>0);return u&&this.bx--,i},δ}(),M=new δ,K=[],L={evt:"dblclick",src:"#tableaux,#waste",dst:"?",dad:".drag",mod:"pointer"}