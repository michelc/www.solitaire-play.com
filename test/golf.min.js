"use strict";function Start(bd){L.start(bd);cm(L.bz);$("#stock").on("click",cp);$(options.src).on(options.evt,".card:last-child",cj);$("#game, #again").on("click",ch);$("#hint").on("click",cl);$("#undo").on("click",cx);$("#tool, #list").on("click",ck);$("body").on("contextmenu",ci);$(document).on("keyup",function(n){n.which===113?ch():n.which===72?cl():n.which===90?n.ctrlKey&&cx():(n.which===13||n.which===32)&&L.cr()&&ch()}).on("keydown",function(n){n.which===32&&n.preventDefault()});cd()}function ci(n){var t,bi;return(n.preventDefault(),cc(),t=L.getAuto(),t===null)?!1:(bi=L.cz(t.aa,t.az,t.ae.id),cg(bi),ci(n),!1)}function co(){try{try{$(".ui-draggable").draggable("destroy")}catch(n){}try{$(".drop").droppable("destroy")}catch(n){}}catch(t){}$("body").css("cursor","auto")}function cp(){L.bl();cm(L.bz);cd()}function cq(n,aa){var az=$("#"+aa).parent().attr("id"),bi=L.cz(aa,az,n.target.id);cg(bi)}function cs(){if(options.dad!==""){var n={containment:"#solitaire",cursor:"move",revert:!0,opacity:1.7,revertDuration:"fast",helper:function(n){var t=$(n.target),af=t.nextAll().addBack(),i=$("<div/>").append(af.clone()).css("margin-top",t.css("margin-top")).css("margin-left",t.css("margin-left"));return af.addClass("hide"),i},start:function(n,t){t.helper.css("z-index",1);var i={hoverClass:"hovered",tolerance:options.mod,drop:function(n,t){cq(n,t.draggable[0].id)}};$(".drop").droppable(i)},stop:function(n,t){t.helper.css("z-index",0);$(".card").removeClass("hide")}};$(options.dad).draggable(n)}}function cd(){$(".dialog").hide();cs();cw();var cr=L.cr();cr!==0&&($("#win h3").hide(),cr>0&&$("#win .win").show(),cr<0&&$("#win .lost").show(),$("#win").show(),$("#overlay").show(),setTimeout(function(){$("#overlay").hide()},1e3))}function cf(cz){var n=L.bx(cz.az);cm([n]);cm([cz.ae])}function cg(bi){if(bi.length!==0){co();for(var n=0;n<bi.length;n++)cf(bi[n]);cd()}}function ch(){L.count<10?(L.start(),cm(L.bz),cd()):location.reload()}function cj(n){var aa=n.target.id,az=$("#"+aa).parent().attr("id"),bi=L.cz(aa,az,options.dst);cg(bi)}function ck(){$(".dialog").hide();var ce=$("#run");ce.show()}function cl(){var bq;for(cc();M.length>0;)clearTimeout(M.pop());if($(".hint").removeClass("hint"),$("#zombie").remove(),bq=L.bm(),bq!==null){var i=500,t=1500,aa=bq.aa,n=bq.ae;n.id==="stock"?(i-=500,t-=500):$("#"+aa).addClass("hint");n.id==="waste"?t-=500:n.ax()?$("#"+n.id).append("<div id='zombie' class='card hint space'>"):(aa=n.al().ap,M.push(setTimeout(function(){$("#"+aa).addClass("hint")},i)));M.push(setTimeout(function(){$(".hint").removeClass("hint");$("#zombie").remove()},t))}}function cm(bz){for(var ar,n=0;n<bz.length;n++)bz[n]!==null&&($("#"+bz[n].id+" .card").remove(),$("#"+bz[n].id).append(bz[n].ad()));L.bh!==null&&(ar=L.bh===9?"10":E[L.bh][0],$(".drop .write div").text(ar))}function cw(){var t=L.bk()?"+":"Ã—",n;$("#stock .write div").text(t);n=L.br.af.length;L.id==="AcesUp"&&(n/=4);n<6&&n>0&&$(".count .card:last-child").html("<div>"+n.toString()+"<\/div>")}function cx(){cg(L.cu())}function cc(){L.bg!==null&&(L.bg.ae.al().ao=!1,cm([L.bg.ae]),L.bg=null)}var F=["Hearts","Spades","Diamonds","Clubs"],E=["Ace","2","3","4","5","6","7","8","9","10","Jack","Queen","King"],G=0,H=1,I=2,J=3,K=Object.freeze({NONE:1,LAST:2,BOTH:3,FULL:4}),A=function(){function A(aa,az,ae){this.aa=aa;this.az=az;this.ae=ae}return A}(),B=function(){function B(n){this.id=n;this.ar=n%13;this.at=Math.floor(n/13);this.ay=this.at===G||this.at===I;this.au=!this.ay;this.ai=!1;this.ao=!1;this.ap=F[this.at][0]+(this.ar===9?"T":E[this.ar][0]);this.html="<div id='"+this.ap+"' class='card down'><\/div>"}return B.prototype.aq=function(){return this.ar===0},B.prototype.as=function(){return this.ar===12},B.prototype.ad=function(){var n=this.html;return this.ao&&(n=n.replace(" down"," down selected")),this.ai&&(n=n.replace(" down"," up")),n},B.prototype.toString=function(){return E[this.ar]+" "+F[this.at]},B}(),C=function(){function C(){this.af=[];for(var n=0;n<52;n++)this.af[n]=new B(n);for(n=0;n<this.af.length;n++)this.af[n]=this.af.splice(Math.floor(this.af.length*Math.random()),1,this.af[n])[0]}return C.prototype.ag=function(n){return n>this.af.length&&(n=this.af.length),this.af.splice(0,n)},C}(),D=function(){function D(ah,n){this.ah=ah;this.af=[];this.id=n;this.aj=-1;this.ak=K.NONE}return D.prototype.al=function(){return this.af[this.af.length-1]},D.prototype.am=function(aa){for(var n=0;n<this.af.length;n++)if(this.af[n].ap===aa)return n;return-1},D.prototype.aw=function(){for(var n=0;n<this.af.length;n++)if(this.af[n].ai)return n;return-1},D.prototype.ax=function(){return this.af.length===0},D.prototype.ac=function(){return this.id[0]==="f"},D.prototype.av=function(){return this.id[0]==="r"},D.prototype.ab=function(){return this.id[0]==="s"},D.prototype.an=function(){return this.id[0]==="t"},D.prototype.ba=function(){return this.id[0]==="w"},D.prototype.ad=function(){var i="",u=this.aj,r,t,n;for(u<0&&(u=this.af.length),r=this.af.length-u,r<0&&(r=0),t=r;t<this.af.length;t++)n=this.af[t].ad(),t===this.af.length-1?n=n.replace(" up"," up drag"):t===0?this.ak!==K.LAST&&(n=n.replace(" up"," up drag")):this.ak===K.FULL&&(n=n.replace(" up"," up drag")),i+=n;return this.ak===K.NONE&&(i=i.replace(/ drag/g,"")),i},D.prototype.toString=function(){return this.id},D}(),P=function(){function P(){this.bz=[];this.be=null;this.br=null;this.bt=null;this.by=[];this.bu=[];this.bi=[];this.bo=!1;this.bp=null;this.bq=-1;this.bs=!0;this.id="Golf";this.bd=1;this.count=0;this.bf=!0;this.bg=null;this.bh=null}return P.prototype.bj=function(){var n,t,r,u,aa,i,e,f,af,o;for(this.bp=[],this.bq=-1,i=this.bw(),e=i.length,n=0;n<e;n++)for(aa=i[n].al().ap,t=0;t<this.bu.length;t++)if(this.bn(aa,i[n].id,this.bu[t].id)){this.bp.push(new A(aa,i[n].id,this.bu[t]));break}for(f=[],n=0;n<e;n++)for(af=this.getCards(i[n]),r=0;r<af.length;r++)for(aa=af[r].ap,t=0;t<this.by.length;t++)if(this.bn(aa,i[n].id,this.by[t].id)){for(o=!1,u=0;u<this.bp.length;u++)if(this.bp[u].az===this.by[t].id&&this.bp[u].ae.id===i[n].id){o=!0;break}o||(r===0?this.bp.push(new A(aa,i[n].id,this.by[t])):f.push(new A(aa,i[n].id,this.by[t])))}f.length>0&&(this.bp=this.bp.concat(f));this.bp.length===0&&this.bk()&&this.bp.push(new A("draw",this.br.id,this.br));this.bs=this.bp.length!==0},P.prototype.bk=function(){return this.id==="Cruel"||this.id==="MonteCarlo"?!this.bf:this.br&&this.br.af.length>0?!0:this.bt&&this.bt.af.length>0?!0:!1},P.prototype.ag=function(){var t=function(ah){var n=null;switch(ah){case 9:break;case 7:n="stock";break;case 8:n="f0";break;default:n="t"+ah.toString()}return n},n;for(this.ce(t),n=0;n<35;n++)this.br.af[n].ai=!0;for(n=0;n<this.by.length;n++)this.by[n].af=this.br.af.splice(0,5);this.bu[0].aj=8;this.bl()},P.prototype.bl=function(){if(this.br.id!==""){if(this.br.ax()){if(this.bt&&!this.bt.ax()){for(this.ct("list",null,null);!this.bt.ax();)this.cy(this.bt,this.br);this.ct("list",null,null)}}else{this.bd!==1&&this.ct("list",null,null);for(var n=0;n<this.bd;n++)this.cy(this.br,this.bt||this.bu[0]);this.bd!==1&&this.ct("list",null,null)}this.bf=!0;this.bj()}},P.prototype.getAuto=function(){var n,bq;for(this.bj(),n=0;n<this.bp.length;n++)if(bq=this.bp[n],bq.aa!=="draw"){if(!bq.ae.ac())if(this.id==="MonteCarlo"){if(bq.az[0]!=="t")continue}else if(this.id==="Pyramid"){if(bq.az[0]!=="t"&&bq.az[0]!=="w")continue}else continue;return bq}return null},P.prototype.getCards=function(ae){var t=ae.af.length,i=t-1,r=[],n;for(this.id==="Yukon"&&(i=ae.aw()),n=i;n<t;n++)r.push(ae.af[n]);return r},P.prototype.bm=function(){return(this.bp===null&&this.bj(),!this.bs)?null:(this.bq++,this.bq===this.bp.length&&(this.bq=0),this.bp[this.bq])},P.prototype.bw=function(){var n=this.by.filter(function(n){return!n.ax()}),t=this.id==="Cruel";return n.sort(function(n,i){var r=i.af.length-n.af.length;return t&&(r=i.al().ar-n.al().ar),r===0&&(r=n.ah-i.ah),r}),this.id==="Pyramid"&&this.bt.af.length>0&&n.push(this.bt),this.id==="Canfield"&&this.bt.af.length>0&&n.push(this.bt),this.id==="Canfield"&&this.be.af.length>0&&n.push(this.be),n},P.prototype.bx=function(n){for(var t=0;t<this.bz.length;t++)if(this.bz[t].id===n)return this.bz[t];return null},P.prototype.bn=function(aa,az,n){var i,t,r,u;return this.bo?!0:az===n?!1:(i=this.bx(az),i.ac())?!1:(t=i.al(),aa!==t.ap)?!1:(r=this.bx(n),i.ab())?r.ac():i.an()&&!r.ac()?!1:r.ab()?!1:(u=r.al(),t.ar===u.ar-1)?!0:t.ar===u.ar+1?!0:t.aq()&&u.as()?!0:t.as()&&u.aq()?!0:!1},P.prototype.cz=function(aa,az,n){if(!this.bn(aa,az,n))return[];var i=this.bx(az),t=this.bx(n),r=i.af.pop();return t.af.push(r),this.bf=!1,[this.ct(aa,az,t)]},P.prototype.ce=function(n){for(var r=new C,i,ae,t=0;t<99;t++){if(i=n(t),i===null)break;this.bz[t]=new D(t,i);ae=this.bz[t];switch(this.id){case"Cruel":ae.ak=K.LAST;break;case"Canfield":ae.ak=K.BOTH;break;case"Klondike":case"Yukon":ae.ak=K.FULL}ae.an()||ae.ak!==K.NONE&&(ae.ak=K.LAST);console.log(i,ae.ak)}for(this.by=[],this.bu=[],t=0;t<this.bz.length;t++)switch(this.bz[t].id[0]){case"r":this.be=this.bz[t];break;case"s":this.br=this.bz[t];break;case"w":this.bt=this.bz[t];break;case"t":this.by.push(this.bz[t]);break;case"f":this.bu.push(this.bz[t])}this.br||(this.br=new D(99,""));this.br.af=r.ag(99);this.bi=[];this.bp=null},P.prototype.start=function(bd){for(var cr=-1;cr===-1;)this.ag(bd),cr=this.cr();this.count++},P.prototype.cr=function(){var n=this.bu.reduce(function(n,t){return n+t.af.length},0);return n===52?1:n===48&&this.id==="AcesUp"?1:(n=this.by.reduce(function(n,t){return n+t.af.length},0),n===0&&this.id==="Golf")?1:n===0&&this.id==="Pyramid"?1:(this.bj(),!this.bs)?-1:0},P.prototype.ct=function(aa,az,ae){this.bp=null;var cz=new A(aa,az,ae);return this.bo||this.bi.push(cz),cz},P.prototype.cy=function(n,t){if(!n.ax()){var i=n.af.pop();t.af.push(i);this.ct(i.ap,n.id,t);i.ai=n.ab();this.ct(i.ap,t.id,null)}},P.prototype.cu=function(){var n,t,i,r,u,bi;if(this.bi.length===0)return[];n=this.bi[this.bi.length-1];t=0;n.aa==="list"?(t=99999,n=this.bi.pop()):t=n.ae===null?2:1;i=[];this.bo=!0;do n=this.bi.pop(),n.aa==="list"?t=0:n.ae===null?(r=this.bx(n.az),u=r.am(n.aa),r.af[u].ai=!r.af[u].ai,i.push(n)):(bi=this.cz(n.aa,n.ae.id,n.az),i.push(bi[0])),t--;while(t>0);return this.bo=!1,i},P}(),L=new P,M=[],options={evt:"click",src:"#tableaux",dst:"f0",dad:"",mod:"intersect"}