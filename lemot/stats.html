<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LeMOT - Stats d'un Wordle fran√ßais</title>
  <meta name="description" content="Les statistiques de LeMOT, un des Wordle en fran√ßais">
  <link rel="canonical" href="https://www.solitaire-play.com/lemot/stats.html">
  <link rel="stylesheet" href="lemot.min.css">
  <link rel="shortcut icon" href="/lemot/images/favicon.ico">
  <style>
    .popup { display: block; }
    #resultats { height: 315px; width: 45ch; user-select: text; }
  </style>
</head>

<body id="lemot">

  <div class="container">

    <div class="popup resultats">
      <div class="header">
        <h2>R√©sultat</h2>
      </div>
      <h3></h3>
      <p>
        <textarea id="resultats"></textarea>
      </p>
      <p>
        <button class="correct" id="calculer">
          GENERER
        </button>
      </p>
    </div>

  </div>

  <script>
    const $calculer = document.querySelector("#calculer");
    const $resultats = document.querySelector("#resultats");
    let sauvegarde = "";
    $resultats.addEventListener("paste", Nettoyage, false);
    $calculer.addEventListener("click", Statistiques, false);

    function Nettoyage() {
      setTimeout(function() { Nettoyage2(); }, 0)
    }

    function Nettoyage2() {
      let contenu = $resultats.value.trim()
      contenu = contenu.replaceAll(" √©v√®nement", "");
      contenu = contenu.replaceAll("(pas de titre) \t\n", "");
      $resultats.value = contenu;
    }

    function Statistiques() {
      // R√©cup√®re le contenu source ou g√©n√©r√©
      const contenu = $resultats.value.trim();
      // Revient aux donn√©es sources quand statistiques sont d√©j√† affich√©es
      if (contenu.includes("üüß") || contenu.includes("üü†")) {
        $resultats.value = sauvegarde;
        $calculer.textContent = "GENERER";
        return;
      }
      // Sauvegarde les donn√©es sources avant de g√©n√©rer les statistiques
      sauvegarde = contenu;
      const lemot6 = contenu.includes("lemot6");
      // Nettoyage du copier / coller de GoatCounter
      const stats = contenu.split('\n')
                          .filter(x => x.includes("puzzle") || x.includes("lemot6"))
                          .map(x => x.replace(" \t", "-").replace("‚ÄØ", "").replace("-X", "-7").split("-"));
      console.dir(stats);
      // Comptabilise pour chaque r√©sultats
      // - 0 : nombre de parties entam√©es
      // - 1 √† 6 : nombre de parties gagn√©es en 1 √† 6 coups
      // - 7 : nombre de parties perdues (X)
      const resultats = [ 0, 0, 0, 0, 0, 0, 0, 0 ];
      for (let i = 0; i < stats.length; i++) {
        const nombre = parseInt(stats[i][0], 10) || 0;
        const essai = parseInt(stats[i][3], 10) || 0;
        resultats[essai] += nombre;
      }
      // Calcule le nombre de parties termin√©es (jou√©es jusqu'au bout)
      const total = resultats.reduce((x, y) => x + y) - resultats[0];
      console.log(resultats.join("\t") + "\t" + total);
      // Calcule le pourcentage de chaque r√©sultat par rapport au nombre de parties termin√©es
      const pourcentages = resultats.map(x => Math.round(x * 100 / total));
      // G√©n√®re 1 carr√© pour chaque 4%
      const bloc = lemot6 ? "üü†" : "üüß";
      const carres = pourcentages.map(x => bloc.repeat(Math.round(x / 4)));
      // Retrouve le num√©ro du puzzle de la veille
      let puzzle = GetPuzzle() - 1;
      if (lemot6) puzzle -= 56;
      // Emplacement pour le mot √† d√©couvrir de la veille
      const reponse = "XXXXXXXXXXXXX"
      // G√©n√®re les statistiques
      let statistiques = `LeMOT #${puzzle} - ${total} parties jou√©es\n`;
      if (lemot6) statistiques = statistiques.replace("LeMOT", "LeMOT6");
      for (let i = 1; i < 8; i++) {
        const essais = i < 7 ? i : "X";
        statistiques += `\n${essais}: ${carres[i]} ${pourcentages[i]}%`;
      }
      statistiques += `\n\n#LeMotStats #LeMotLeJeu #${reponse}`;
      const url = "https://www.goatcounter.com/ + üñêÔ∏è";
      statistiques += `\n\n${url}`;
      // Affiche et logue les statistiques
      $resultats.value = statistiques;
      console.log(statistiques);
      // Change l'intitul√© du bouton pour revoir les sources
      $calculer.textContent = "CHIFFRES";
    }

    function GetPuzzle() {
      const debut = new Date(Date.UTC(2022, 0, 9));
      const jour = new Date(Date.now());
      const difference = jour.getTime() - debut.getTime();
      return Math.ceil(difference / 1000 / 60 / 60 / 24);
    }
  </script>

</body>

</html>
